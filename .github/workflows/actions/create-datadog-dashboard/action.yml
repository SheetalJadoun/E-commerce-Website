name: Create Datadog Dashboard

description: 'A GitHub Action to create a Datadog dashboard'

inputs:
  datadog_api_key:
    description: 'Datadog API Key'
    required: true
  datadog_app_key:
    description: 'Datadog Application Key'
    required: true
  dashboard_name:
    description: 'Name of the Datadog dashboard to create'
    required: true
    default: 'My Dashboard'

runs:
  using: 'docker'
  image: 'datadog/agent:latest'

steps:
  - name: Checkout code
    uses: actions/checkout@v2

  - name: Create Datadog Dashboard
    run: |
      # Use Datadog CLI to create dashboard and add widgets
      datadog dashboard create --title "My Dashboard"
      datadog widget create --type timeseries --title "CPU usage" --query "avg:system.cpu.user{*}" --yaxis "{ \"scale\": \"linear\", \"min\": 0, \"max\": 100 }" --autoscale
      
    env:
      DATADOG_API_KEY: ${{ inputs.datadog_api_key }}
      DATADOG_APP_KEY: ${{ inputs.datadog_app_key }}
